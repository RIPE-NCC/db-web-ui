<div>
    <org-drop-down></org-drop-down>
    <section id="searchSection">
        <h1 class="documentFirstHeading">{{ titleEnvironment }} Database Query</h1>
        <form name="searchform" (ngSubmit)="submitSearchForm()">
            <div>
                <div [ngClass]="{ 'with-results': isFiltersDisplayed() }" [style.fontSize.rem]="1.12">
                    <search-field [(queryText)]="qp.queryText" (queryTextChange)="filterCheckboxes()"></search-field>
                    <div>
                        <query-flags [inputTerm]="qp.queryText"></query-flags>
                    </div>
                </div>
                @if (isFiltersDisplayed()) {
                <div class="dropdown-menus-bar">
                    <div class="dropdown-menus-bar-buttons">
                        <button mat-button type="button" id="typeMenu" [matMenuTriggerFor]="typesMenu" #typesTrigger="matMenuTrigger">
                            Types {{ printNumberSelected(this.numberSelectedTypes) }}
                            @if (typesTrigger.menuOpen) {
                            <span class="fa-light fa-chevron-up"></span>
                            } @else {
                            <span class="fa-light fa-chevron-down"></span>
                            }
                        </button>
                        <mat-menu #typesMenu="matMenu" yPosition="below">
                            <types-panel
                                [(queryParameters)]="qp"
                                [availableTypes]="availableTypes"
                                (numberSelected)="numberSelectedTypes = $event"
                            ></types-panel>
                        </mat-menu>
                        <button
                            mat-button
                            type="button"
                            id="hierarchyFlagsMenu"
                            [matMenuTriggerFor]="hierarchyFlagsMenu"
                            #hierarchyTrigger="matMenuTrigger"
                            [disabled]="isDisabledHierarchyDropdown()"
                        >
                            Hierarchy flags {{ printNumberSelected(this.numberSelectedHierarchyItems) }}
                            @if (hierarchyTrigger.menuOpen) {
                            <span class="fa-light fa-chevron-up"></span>
                            } @else {
                            <span class="fa-light fa-chevron-down"></span>
                            }
                        </button>
                        <mat-menu #hierarchyFlagsMenu="matMenu" yPosition="below">
                            <hierarchy-flags [(queryParameters)]="qp" (numberSelected)="numberSelectedHierarchyItems = $event"></hierarchy-flags>
                        </mat-menu>
                        <button mat-button type="button" id="inverseLookupMenu" [matMenuTriggerFor]="inverseLookupMenu" #inverseLookupTrigger="matMenuTrigger">
                            Inverse lookup {{ printNumberSelected(numberSelectedInverseLookups) }}
                            @if (inverseLookupTrigger.menuOpen) {
                            <span class="fa-light fa-chevron-up"></span>
                            } @else {
                            <span class="fa-light fa-chevron-down"></span>
                            }
                        </button>
                        <mat-menu #inverseLookupMenu="matMenu" yPosition="below">
                            <inverse-lookup-panel
                                [(queryParameters)]="qp"
                                [availableTypes]="availableTypes"
                                (numberSelected)="numberSelectedInverseLookups = $event"
                                [typeOfSearchedTerm]="typeOfSearchedTerm"
                            ></inverse-lookup-panel>
                        </mat-menu>
                        <button mat-button type="button" id="advanceFilterMenu" [matMenuTriggerFor]="advanceFilterMenu" #advanceFilterTrigger="matMenuTrigger">
                            Advanced filter {{ printNumberSelected(this.numberSelectedAdvanceFilterItems) }}
                            @if (advanceFilterTrigger.menuOpen) {
                            <span class="fa-light fa-chevron-up"></span>
                            } @else {
                            <span class="fa-light fa-chevron-down"></span>
                            }
                        </button>
                        <mat-menu #advanceFilterMenu="matMenu" yPosition="below">
                            <advance-filter-panel [(queryParameters)]="qp" (numberSelected)="numberSelectedAdvanceFilterItems = $event"></advance-filter-panel>
                        </mat-menu>
                    </div>
                    <div>
                        <button mat-flat-button color="primary" [disableRipple]="true" id="applyFilters">APPLY FILTERS</button>
                        <button mat-flat-button [disableRipple]="true" id="resetFilters" [disabled]="!isFilteringResults()" (click)="resetFilters()">
                            RESET FILTERS
                        </button>
                    </div>
                </div>
                }
            </div>
            <div>
                <submitting-agreement></submitting-agreement>
            </div>
            <br />
        </form>
    </section>
    <section>
        <a id="anchorTop"></a>
        <div class="visualClear"></div>
        <div class="documentActions"></div>
        <div class="resultsSection">
            @if (!showsDocsLink) {
            <h1 class="documentFirstHeading">Search results</h1>
            }
            <div>
                @if (link.perma && results?.length > 0) {
                <button
                    class="perma-link"
                    id="sharePermaLink"
                    [matMenuTriggerFor]="sharePermaLink"
                    #sharePermaLinkTrigger="matMenuTrigger"
                    mat-icon-button
                    matSuffix
                    matTooltip="Share Panel"
                    matTooltipPosition="left"
                >
                    @if (!sharePermaLinkTrigger.menuOpen) {
                    <mat-icon matSuffix class="fa-light fa-share-nodes"></mat-icon>
                    } @else {
                    <mat-icon matSuffix class="fa-solid fa-share-nodes"></mat-icon>
                    }
                </button>
                }
                <mat-menu #sharePermaLink="matMenu" yPosition="below">
                    <share-panel [link]="link"></share-panel>
                </mat-menu>
            </div>
        </div>
        <div class="documentByLine"><span class="byline"></span></div>
        <div class="documentDescription"></div>
    </section>
    <section class="resultsSection" id="resultsSection">
        @if (results?.length > 0) {
        <div class="full-width">
            <p style="margin: 0" [innerHTML]="'msg.searchResults.text' | label"></p>
            @for (whoisObject of results; track whoisObject) {
            <div class="clearfix">
                <div class="resultpane">
                    <lookup [whoisObject]="whoisObject"></lookup>
                </div>
            </div>
            } @if (showScroller) {
            <p scroller (scrolled)="lastResultOnScreen()">
                <loading-indicator></loading-indicator>
            </p>
            }
        </div>
        } @if (showNoResultsMsg) {
        <div class="resultpane no-result-msg">No results found, try changing the search term or filters</div>
        }
    </section>
    @if (showTemplatePanel) {
    <section id="templateResultsSection">
        <p [innerHTML]="'msg.searchResults.text' | label"></p>
        <lookup-template [query]="queriedTemplateObject"></lookup-template>
    </section>
    } @if (showsDocsLink) {
    <section id="informationSection">
        <div class="row">
            <div class="card-info">
                <div class="padding margin-bottom">
                    <p>Querying the {{ headEnvironment }} Database</p>
                    You can query the RIPE Database via the web interface, the RESTful API or a command line tool. Learn more about each option by clicking the
                    link below.
                    <p>&nbsp;</p>
                    @if (!properties.isTestEnv()) {
                    <a href="https://docs.db.ripe.net/How-to-Query-the-RIPE-Database/" target="_blank" class="link-color">
                        Go to documentation <em class="fa-light fa-arrow-up-right-from-square"></em>
                    </a>
                    } @if (properties.isTestEnv()) {
                    <a href="https://docs.db.ripe.net/Appendices/Appendix-J--Ripe-Test-Database/" target="_blank" class="link-color"
                        >Go to documentation <em class="fa-light fa-arrow-up-right-from-square"></em>
                    </a>
                    }
                </div>
            </div>
            <div class="card-info">
                <div class="padding margin-bottom">
                    <p>RESTful API</p>
                    The RESTful API can only process one object at a time. If you want to process several objects simultaneously, you need to write a script on
                    the client side to handle the list of objects and feed them.

                    <p>&nbsp;</p>
                    <a href="https://docs.db.ripe.net/Update-Methods/RESTful-API" rel="noopener" target="_blank" class="link-color"
                        >Go to documentation <em class="fa-light fa-arrow-up-right-from-square"></em>
                    </a>
                </div>
            </div>
            <div class="card-info">
                <div class="padding margin-bottom">
                    <p>{{ properties.SOURCE === 'RIPE' ? 'Test' : 'RIPE' }} Database</p>
                    @if (properties.SOURCE === 'RIPE') {
                    <span>
                        You can use this environment to learn and experiment with the RIPE Database. It uses a TEST source. Important: All changes are reverted
                        every day at night.
                    </span>
                    } @if (properties.SOURCE !== 'RIPE') {
                    <span>
                        TEST environment is to learn and experiment with RIPE Database and all changes are reverted in the night. Switch to RIPE Database for
                        live action.
                    </span>
                    }
                    <p></p>
                    <!-- Decided different color by design. This link will open same application while other not -->
                    <a [href]="properties.QUERY_PAGE_LINK_TO_OTHER_DB" target="_blank" class="inner-link-color"
                        >Go to {{ properties.SOURCE === 'RIPE' ? 'Test' : 'RIPE' }} Database <em class="fa-light fa-arrow-right"></em>
                    </a>
                </div>
            </div>
            <div class="card-info">
                <certificate-info></certificate-info>
            </div>
            @if (showsDocsLink) {
            <typeform-banner></typeform-banner>
            }
        </div>
    </section>
    }
    <whois-version [version]="whoisVersion"></whois-version>
    <web-app-version></web-app-version>
</div>
